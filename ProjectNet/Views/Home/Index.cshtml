@model List<ChatController.ChatMessage>
@{
    ViewData["Title"] = "AI Chat";
}

<div class="chat-history" id="chatHistory">
    @if (Model != null && Model.Any())
    {
        foreach (var message in Model)
        {
            <div class="message @(message.IsUser ? "user-message" : "ai-message")">
                <div class="message-header">
                    <strong class="sender-name">@(message.IsUser ? "You:" : "Echo:")</strong>
                </div>
                <div class="message-content">
                    @message.Content
                </div>
            </div>
        }
    }
    else
    {
        <div class="no-messages">
            Welcome @Context.Session.GetString("Username") 👋 Chat with me!
        </div>

    }
</div>

<form id="chatForm" asp-controller="Chat" asp-action="SendMessage" method="post" class="chat-form">
    @Html.AntiForgeryToken() @*protects from csrf attacks*@
    <div class="chat-input-box">
        <textarea name="message"
                    class="chat-input"
                    placeholder="Type your message..."
                    rows="2"
                    required
                    onkeydown="if(event.key==='Enter' && !event.shiftKey){ event.preventDefault(); this.form.submit(); }"></textarea>
    </div>
</form>

@section Scripts {
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            const chatHistory = document.getElementById('chatHistory');
            if (chatHistory) {
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        });
    </script>
}

